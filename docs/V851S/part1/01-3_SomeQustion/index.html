<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-V851S/part1/01-3_SomeQustion" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">常见问题 | 全志Vision</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://vision.100ask.net/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://vision.100ask.net/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://vision.100ask.net/docs/V851S/part1/01-3_SomeQustion"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="常见问题 | 全志Vision"><meta data-rh="true" name="description" content="1.编译执行make时报文件系统权限不够的问题"><meta data-rh="true" property="og:description" content="1.编译执行make时报文件系统权限不够的问题"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://vision.100ask.net/docs/V851S/part1/01-3_SomeQustion"><link data-rh="true" rel="alternate" href="https://vision.100ask.net/docs/V851S/part1/01-3_SomeQustion" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://vision.100ask.net/en/docs/V851S/part1/01-3_SomeQustion" hreflang="en"><link data-rh="true" rel="alternate" href="https://vision.100ask.net/docs/V851S/part1/01-3_SomeQustion" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.e3ab61ce.css">
<script src="/assets/js/runtime~main.ff6abb66.js" defer="defer"></script>
<script src="/assets/js/main.353401d4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="东山PI" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="东山PI" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">全志Vision</b></a><a class="navbar__item navbar__link" href="/docs/EmbeddedAIBasics/BoardIntroduction">嵌入式AI基础</a><a class="navbar__item navbar__link" href="/docs/V853/BoardIntroduction">V853-AICT</a><a class="navbar__item navbar__link" href="/docs/V851se-TinyVision/BoardIntroduction">V851se-TinyVision</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/V851S/Describe">V851s-Lizard</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/docs/V851S/part1/01-3_SomeQustion" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li><li><a href="/en/docs/V851S/part1/01-3_SomeQustion" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li></ul></div><a href="https://github.com/100askTeam/AllwinnerVisionIC-Docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/V851S/Describe">柚木PI蜥蜴硬件简述</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/V851S/SupportingPackage">配套资源</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/V851S/ConfigHostEnv">安装并配置开发环境</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/快速启动">快速启动</a><button aria-label="折叠侧边栏分类 &#x27;快速启动&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/V851S/part1/01-1_-QuickStart">快速开始使用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/V851S/part1/01-2_FlashSystem">更新系统固件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/V851S/part1/01-3_SomeQustion">常见问题</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/docs/category/最小系统快速上手">最小系统快速上手</a><button aria-label="折叠侧边栏分类 &#x27;最小系统快速上手&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/V851S/part2/02-1_RunHelloword">运行输出hello word</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/V851S/part2/02-2_RunHellowordDriver">编译运行Helloword驱动</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/docs/category/tina-sdk系统开发">Tina-SDK系统开发</a><button aria-label="折叠侧边栏分类 &#x27;Tina-SDK系统开发&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/V851S/part3/03-1_TinaSDK_DevelopmentGuide">使用Tina-SDK编译构建系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/V851S/part3/03-2_TinaSDK_BuildBootloader">使用Tina-SDK编译构建Bootloader</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/V851S/part3/03-3_TinaSDK_BuildLinuxKernel">使用Tina-SDK编译打包Linux Kernel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/V851S/part3/03-4_TinaSDK_BuildRootfs">使用buildroot-SDK编译构建rootfs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/V851S/part3/03-5_Tina-SDK_DevelopmentGuide">使用Tina-SDK编译构建系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/V851S/part3/03-6_TinaSDK_SupportWifiBluetooth">使用Tina-SDK支持启动WiFi</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/V851S/part3/03-7_TinaSDK_SupportMIPICamera">使用Tina-SDK支持MIPI摄像头</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/快速启动"><span itemprop="name">快速启动</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">常见问题</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>常见问题</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1编译执行make时报文件系统权限不够的问题">1.编译执行make时报文件系统权限不够的问题<a href="#1编译执行make时报文件系统权限不够的问题" class="hash-link" aria-label="1.编译执行make时报文件系统权限不够的问题的直接链接" title="1.编译执行make时报文件系统权限不够的问题的直接链接">​</a></h2>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">==================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target/allwinner/v851s-lizard/tina_busybox-init-basefiles.mk is called to generate shell scripts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">==================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(/home/book/workspace/tina-v853/openwrt/target/v851s/v851s-lizard/busybox-init-base-files_generate/rootfs_hook_squash.sh /home/book/workspace/tina-v853/openwrt/target/v851s/v851s-lizard/busybox-init-base-files &gt;/dev/null) || { \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	echo &quot;Execute the /home/book/workspace/tina-v853/openwrt/target/v851s/v851s-lizard/busybox-init-base-files_generate/rootfs_hook_squash.sh is failed&quot;; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	exit 1; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/bin/sh: 1: /home/book/workspace/tina-v853/openwrt/target/v851s/v851s-lizard/busybox-init-base-files_generate/rootfs_hook_squash.sh: Permission denied</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Execute the /home/book/workspace/tina-v853/openwrt/target/v851s/v851s-lizard/busybox-init-base-files_generate/rootfs_hook_squash.sh is failed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tina_busybox-init-base-files.mk:14: recipe for target &#x27;all&#x27; failed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make[4]: *** [all] Error 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make[4]: Leaving directory &#x27;/home/book/workspace/tina-v853/openwrt/target/v851s/v851s-lizard&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Makefile:228: recipe for target &#x27;/home/book/workspace/tina-v853/out/v851s/lizard/openwrt/build_dir/target/linux-v851s-lizard/busybox-init-base-files/.built&#x27; failed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make[3]: *** [/home/book/workspace/tina-v853/out/v851s/lizard/openwrt/build_dir/target/linux-v851s-lizard/busybox-init-base-files/.built] Error 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make[3]: Leaving directory &#x27;/home/book/workspace/tina-v853/openwrt/package/allwinner/system/busybox-init-base-files&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time: package/subpackage/allwinner/system/busybox-init-base-files/compile#0.32#0.25#0.55</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ERROR: package/subpackage/allwinner/system/busybox-init-base-files failed to build.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package/Makefile:114: recipe for target &#x27;package/subpackage/allwinner/system/busybox-init-base-files/compile&#x27; failed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make[2]: *** [package/subpackage/allwinner/system/busybox-init-base-files/compile] Error 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make[2]: Leaving directory &#x27;/home/book/workspace/tina-v853/openwrt/openwrt&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package/Makefile:110: recipe for target &#x27;/home/book/workspace/tina-v853/openwrt/openwrt/staging_dir/target/stamp/.package_compile&#x27; failed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make[1]: *** [/home/book/workspace/tina-v853/openwrt/openwrt/staging_dir/target/stamp/.package_compile] Error 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make[1]: Leaving directory &#x27;/home/book/workspace/tina-v853/openwrt/openwrt&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/home/book/workspace/tina-v853/openwrt/openwrt/include/toplevel.mk:236: recipe for target &#x27;world&#x27; failed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make: *** [world] Error 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make: Leaving directory &#x27;/home/book/workspace/tina-v853/openwrt/openwrt&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO: build_openwrt_rootfs failed</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>解决办法是按如下方式增加文件权限</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">book@100ask:~/workspace/tina-v853$ chmod 755 /home/book/workspace/tina-v853/openwrt/target/v851s/v851s-lizard/busybox-init-base-files_generate/mk_extra_dir.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2打包pack时提示文件系统大小太大">2.打包pack时提示文件系统大小太大<a href="#2打包pack时提示文件系统大小太大" class="hash-link" aria-label="2.打包pack时提示文件系统大小太大的直接链接" title="2.打包pack时提示文件系统大小太大的直接链接">​</a></h2>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ERROR: dl file rootfs.fex size too large</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ERROR: filename = rootfs.fex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ERROR: dl_file_size = 53760 sector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ERROR: part_size = 45360 sector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">update_for_part_info -1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ERROR: update mbr file fail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ERROR: update_mbr failed</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>原本的part_size的值为45360，需要修改成dl_file_size的值53760</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">book@100ask:~/tina-v853$ vim device/config/chips/v851s/configs/lizard/linux-4.9/sys_partition.fex</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img loading="lazy" src="https://photos.100ask.net/dongshanpi-docs/YuzukiHD-Lizard/YuzukiHD-Lizard-03-2-Question-1.png" alt="YuzukiHD-Lizard-03-2-Question-1" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3开发板启动时启动nand失败">3.开发板启动时，启动nand失败<a href="#3开发板启动时启动nand失败" class="hash-link" aria-label="3.开发板启动时，启动nand失败的直接链接" title="3.开发板启动时，启动nand失败的直接链接">​</a></h2>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[    4.087239]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[    4.087836] device_chose finished 122!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[    4.133404] Please append a correct &quot;root=&quot; boot option; here are the available partitions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[    4.142801] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[    4.152057] CPU: 0 PID: 1 Comm: swapper Not tainted 4.9.191 #1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[    4.158582] Hardware name: sun8iw21</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[    4.162517] [&lt;c010d5a0&gt;] (unwind_backtrace) from [&lt;c010a694&gt;] (show_stack+0x10/0x14)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[    4.171192] [&lt;c010a694&gt;] (show_stack) from [&lt;c017050c&gt;] (panic+0xac/0x2b8)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[    4.178899] [&lt;c017050c&gt;] (panic) from [&lt;c09012cc&gt;] (mount_block_root+0x258/0x300)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[    4.187284] [&lt;c09012cc&gt;] (mount_block_root) from [&lt;c0901500&gt;] (prepare_namespace+0x118/0x178)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[    4.196834] [&lt;c0901500&gt;] (prepare_namespace) from [&lt;c0900eb4&gt;] (kernel_init_freeable+0x144/0x178)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[    4.206771] [&lt;c0900eb4&gt;] (kernel_init_freeable) from [&lt;c067464c&gt;] (kernel_init+0x8/0x118)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[    4.215932] [&lt;c067464c&gt;] (kernel_init) from [&lt;c0106e08&gt;] (ret_from_fork+0x14/0x2c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[    4.224410] ---[ end Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[    4.234532] sunxi dump enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[    4.237944] dump regs done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[    4.241001] flush cache done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[    4.244239] crashdump enter</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在/tina-v853/kernel/linux-4.9/drivers/mtd/awnand/spinand/physic/目录下，将我们提供的id.c文件替换原本目录中的id.c文件。id.c文件内容为：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// SPDX-License-Identifier: GPL-2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define pr_fmt(fmt) &quot;sunxi-spinand-phy: &quot; fmt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;linux/kernel.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;linux/module.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;linux/mtd/aw-spinand.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;linux/of.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;physic.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define KB (1024)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define MB (KB * 1024)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define to_kb(size) (size / KB)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define to_mb(size) (size / MB)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* manufacture num */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define MICRON_MANUFACTURE	0x2c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define GD_MANUFACTURE		0xc8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define ATO_MANUFACTURE		0x9b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define WINBOND_MANUFACTURE	0xef</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define MXIC_MANUFACTURE	0xc2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define TOSHIBA_MANUFACTURE	0x98</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define ETRON_MANUFACTURE	0xd5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define XTXTECH_MANUFACTURE	0x0b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define DSTECH_MANUFACTURE	0xe5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define FORESEE_MANUFACTURE	0xcd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define ZETTA_MANUFACTURE	0xba</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define FM_MANUFACTURE		0xa1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct spinand_manufacture m;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct aw_spinand_phy_info gigadevice[] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.Model		= &quot;GD5F1GQ4UCYIG&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.NandID		= {0xc8, 0xb1, 0x48, 0xff, 0xff, 0xff, 0xff, 0xff},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.DieCntPerChip  = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.SectCntPerPage = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.PageCntPerBlk  = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BlkCntPerDie	= 1024,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OobSizePerPage = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OperationOpt	= SPINAND_QUAD_READ | SPINAND_QUAD_PROGRAM |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			SPINAND_DUAL_READ | SPINAND_ONEDUMMY_AFTER_RANDOMREAD,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.MaxEraseTimes  = 50000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccType	= BIT3_LIMIT2_TO_6_ERR7,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccProtectedType = SIZE16_OFF0_LEN16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BadBlockFlag	= BAD_BLK_FLAG_FRIST_1_PAGE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.Model		= &quot;GD5F1GQ4UBYIG&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.NandID		= {0xc8, 0xd1, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.DieCntPerChip  = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.SectCntPerPage = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.PageCntPerBlk  = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BlkCntPerDie	= 1024,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OobSizePerPage = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OperationOpt	= SPINAND_QUAD_READ | SPINAND_QUAD_PROGRAM |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			SPINAND_DUAL_READ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.MaxEraseTimes  = 50000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccFlag	= HAS_EXT_ECC_SE01,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccType	= BIT4_LIMIT5_TO_7_ERR8_LIMIT_12,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccProtectedType = SIZE16_OFF4_LEN8_OFF4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BadBlockFlag	= BAD_BLK_FLAG_FRIST_1_PAGE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		/* GD5F2GQ4UB9IG did not check yet */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.Model		= &quot;GD5F2GQ4UB9IG&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.NandID		= {0xc8, 0xd2, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.DieCntPerChip  = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.SectCntPerPage = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.PageCntPerBlk  = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BlkCntPerDie	= 2048,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OobSizePerPage = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OperationOpt	= SPINAND_QUAD_READ | SPINAND_QUAD_PROGRAM |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			SPINAND_DUAL_READ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.MaxEraseTimes  = 50000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccFlag	= HAS_EXT_ECC_SE01,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccType	= BIT4_LIMIT5_TO_7_ERR8_LIMIT_12,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccProtectedType = SIZE16_OFF4_LEN12,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BadBlockFlag	= BAD_BLK_FLAG_FRIST_1_PAGE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.Model    = &quot;GD5F1GQ5UEYIG&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.NandID    = {0xc8, 0x51, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.DieCntPerChip  = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.SectCntPerPage = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.PageCntPerBlk  = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BlkCntPerDie  = 1024,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OobSizePerPage = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OperationOpt  = SPINAND_QUAD_READ | SPINAND_QUAD_PROGRAM |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			SPINAND_DUAL_READ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.MaxEraseTimes  = 50000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccFlag  = HAS_EXT_ECC_SE01,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccType  = BIT4_LIMIT5_TO_7_ERR8_LIMIT_12,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccProtectedType = SIZE16_OFF4_LEN12,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BadBlockFlag  = BAD_BLK_FLAG_FRIST_1_PAGE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.Model		= &quot;F50L1G41LB(2M)&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.NandID		= {0xc8, 0x01, 0x7f, 0x7f, 0x7f, 0xff, 0xff, 0xff},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.DieCntPerChip  = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.SectCntPerPage = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.PageCntPerBlk  = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BlkCntPerDie	= 1024,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OobSizePerPage = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OperationOpt	= SPINAND_QUAD_READ | SPINAND_QUAD_PROGRAM |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			SPINAND_DUAL_READ | SPINAND_QUAD_NO_NEED_ENABLE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.MaxEraseTimes  = 65000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccType	= BIT2_LIMIT1_ERR2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccProtectedType = SIZE16_OFF4_LEN4_OFF8,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BadBlockFlag	= BAD_BLK_FLAG_FIRST_2_PAGE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.Model		= &quot;GD5F2GM7UEYI&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.NandID		= {0xc8, 0x92, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.DieCntPerChip  = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.SectCntPerPage = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.PageCntPerBlk  = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BlkCntPerDie	= 2048,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OobSizePerPage = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OperationOpt	= SPINAND_QUAD_READ | SPINAND_QUAD_PROGRAM |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			SPINAND_DUAL_READ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.MaxEraseTimes  = 50000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccFlag	= HAS_EXT_ECC_SE01,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccType	= BIT4_LIMIT5_TO_7_ERR8_LIMIT_12,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccProtectedType = SIZE16_OFF0_LEN16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BadBlockFlag	= BAD_BLK_FLAG_FRIST_1_PAGE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct aw_spinand_phy_info micron[] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.Model		= &quot;MT29F1G01ABAGDWB&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.NandID		= {0x2c, 0x14, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.DieCntPerChip  = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.SectCntPerPage = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.PageCntPerBlk  = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BlkCntPerDie	= 1024,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OobSizePerPage = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OperationOpt	= SPINAND_QUAD_READ | SPINAND_QUAD_PROGRAM |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			SPINAND_DUAL_READ | SPINAND_QUAD_NO_NEED_ENABLE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.MaxEraseTimes  = 65000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccType	= BIT3_LIMIT5_ERR2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccProtectedType = SIZE16_OFF32_LEN16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BadBlockFlag	= BAD_BLK_FLAG_FRIST_1_PAGE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.Model		= &quot;MT29F2G01ABAGDWB&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.NandID		= {0x2c, 0x24, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.DieCntPerChip  = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.SectCntPerPage = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.PageCntPerBlk  = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BlkCntPerDie	= 2048,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OobSizePerPage = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OperationOpt	= SPINAND_QUAD_READ | SPINAND_QUAD_PROGRAM |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			SPINAND_DUAL_READ | SPINAND_QUAD_NO_NEED_ENABLE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.MaxEraseTimes  = 65000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccType	= BIT3_LIMIT5_ERR2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccProtectedType = SIZE16_OFF32_LEN16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BadBlockFlag	= BAD_BLK_FLAG_FRIST_1_PAGE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct aw_spinand_phy_info xtx[] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		/* XTX26G02A */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.Model		= &quot;XTX26G02A&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.NandID		= {0x0B, 0xE2, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.DieCntPerChip  = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.SectCntPerPage = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.PageCntPerBlk  = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BlkCntPerDie	= 2048,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OobSizePerPage = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OperationOpt	= SPINAND_QUAD_READ | SPINAND_QUAD_PROGRAM |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			SPINAND_DUAL_READ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.MaxEraseTimes  = 50000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.ecc_status_shift = ECC_STATUS_SHIFT_2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccType	= BIT4_LIMIT5_TO_7_ERR8_LIMIT_12,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccProtectedType = SIZE16_OFF8_LEN16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BadBlockFlag	= BAD_BLK_FLAG_FRIST_1_PAGE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		/* XTX26G02A */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.Model		= &quot;XTX26G01A&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.NandID		= {0x0B, 0xE1, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.DieCntPerChip  = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.SectCntPerPage = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.PageCntPerBlk  = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BlkCntPerDie	= 1024,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OobSizePerPage = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OperationOpt	= SPINAND_QUAD_READ | SPINAND_QUAD_PROGRAM |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			SPINAND_DUAL_READ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.MaxEraseTimes  = 50000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.ecc_status_shift = ECC_STATUS_SHIFT_2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccType	= BIT4_LIMIT5_TO_7_ERR8_LIMIT_12,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccProtectedType = SIZE16_OFF8_LEN16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BadBlockFlag	= BAD_BLK_FLAG_FRIST_1_PAGE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		/* XT26G01C */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.Model		= &quot;XT26G01C&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.NandID		= {0x0B, 0x11, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.DieCntPerChip  = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.SectCntPerPage = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.PageCntPerBlk  = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BlkCntPerDie	= 1024,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OobSizePerPage = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OperationOpt	= SPINAND_QUAD_READ | SPINAND_QUAD_PROGRAM |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			SPINAND_DUAL_READ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.MaxEraseTimes  = 50000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.ecc_status_shift = ECC_STATUS_SHIFT_4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccType	= BIT4_LIMIT5_TO_8_ERR9_TO_15,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccProtectedType = SIZE16_OFF0_LEN16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BadBlockFlag	= BAD_BLK_FLAG_FRIST_1_PAGE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		/* XT26G02C */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.Model		= &quot;XT26G02CWSIG&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.NandID		= {0x0B, 0x12, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.DieCntPerChip  = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.SectCntPerPage = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.PageCntPerBlk  = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BlkCntPerDie	= 2048,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OobSizePerPage = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OperationOpt	= SPINAND_DUAL_READ | SPINAND_QUAD_PROGRAM |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			SPINAND_DUAL_READ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.MaxEraseTimes  = 50000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.ecc_status_shift = ECC_STATUS_SHIFT_2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccType	= BIT4_LIMIT5_TO_7_ERR8_LIMIT_12,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccProtectedType = SIZE16_OFF8_LEN16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BadBlockFlag	= BAD_BLK_FLAG_FRIST_1_PAGE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct aw_spinand_phy_info fm[] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		/* only rw stress test */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.Model		= &quot;FM25S01&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.NandID		= {0xa1, 0xa1, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.DieCntPerChip  = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.SectCntPerPage = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.PageCntPerBlk  = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BlkCntPerDie	= 1024,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OobSizePerPage = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OperationOpt	= SPINAND_QUAD_READ | SPINAND_QUAD_PROGRAM |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			SPINAND_DUAL_READ | SPINAND_QUAD_NO_NEED_ENABLE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.MaxEraseTimes  = 65000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccType	= BIT2_LIMIT1_ERR2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccProtectedType = SIZE16_OFF0_LEN16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BadBlockFlag = BAD_BLK_FLAG_FIRST_2_PAGE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct aw_spinand_phy_info etron[] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct aw_spinand_phy_info toshiba[] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct aw_spinand_phy_info ato[] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct aw_spinand_phy_info mxic[] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.Model		= &quot;MX35LF1GE4AB&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.NandID		= {0xc2, 0x12, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.DieCntPerChip  = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.SectCntPerPage = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.PageCntPerBlk  = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BlkCntPerDie	= 1024,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OobSizePerPage = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OperationOpt	= SPINAND_QUAD_READ | SPINAND_QUAD_PROGRAM |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			SPINAND_DUAL_READ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.MaxEraseTimes  = 65000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccFlag	= HAS_EXT_ECC_STATUS,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccType	= BIT4_LIMIT3_TO_4_ERR15,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 * MX35LF1GE4AB should use SIZE16_OFF4_LEN12, however, in order</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 * to compatibility with versions already sent to customers,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 * which do not use general physical layout, we used</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 * SIZE16_OFF4_LEN4_OFF8 instead.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccProtectedType = SIZE16_OFF4_LEN4_OFF8,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BadBlockFlag = BAD_BLK_FLAG_FIRST_2_PAGE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.Model		= &quot;MX35LF2GE4AD&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.NandID		= {0xc2, 0x26, 0x03, 0xff, 0xff, 0xff, 0xff, 0xff},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.DieCntPerChip  = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.SectCntPerPage = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.PageCntPerBlk  = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BlkCntPerDie	= 2048,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OobSizePerPage = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OperationOpt	= SPINAND_QUAD_READ | SPINAND_QUAD_PROGRAM |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			SPINAND_DUAL_READ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.MaxEraseTimes  = 65000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccFlag	= HAS_EXT_ECC_STATUS,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccType	= BIT4_LIMIT5_TO_8_ERR9_TO_15,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccProtectedType = SIZE16_OFF4_LEN4_OFF8,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BadBlockFlag = BAD_BLK_FLAG_FIRST_2_PAGE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct aw_spinand_phy_info winbond[] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.Model		= &quot;W25N01GVZEIG&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.NandID		= {0xef, 0xaa, 0x21, 0xff, 0xff, 0xff, 0xff, 0xff},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.DieCntPerChip  = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.SectCntPerPage = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.PageCntPerBlk  = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BlkCntPerDie	= 1024,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OobSizePerPage = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OperationOpt	= SPINAND_QUAD_READ | SPINAND_QUAD_PROGRAM |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			SPINAND_DUAL_READ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.MaxEraseTimes  = 65000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccType	= BIT2_LIMIT1_ERR2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccProtectedType = SIZE16_OFF4_LEN4_OFF8,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BadBlockFlag = BAD_BLK_FLAG_FRIST_1_PAGE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct aw_spinand_phy_info dosilicon[] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.Model		= &quot;DS35X1GAXXX&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.NandID		= {0xe5, 0x71, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.DieCntPerChip  = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.SectCntPerPage = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.PageCntPerBlk  = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BlkCntPerDie	= 1024,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OobSizePerPage = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OperationOpt	= SPINAND_QUAD_READ | SPINAND_QUAD_PROGRAM |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			SPINAND_DUAL_READ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.MaxEraseTimes  = 65000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccType	= BIT2_LIMIT1_ERR2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccProtectedType = SIZE16_OFF4_LEN4_OFF8,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BadBlockFlag = BAD_BLK_FLAG_FIRST_2_PAGE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct aw_spinand_phy_info foresee[] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.Model		= &quot;FS35ND01G-S1F1QWFI000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.NandID		= {0xcd, 0xb1, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.DieCntPerChip  = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.SectCntPerPage = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.PageCntPerBlk  = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BlkCntPerDie	= 1024,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OobSizePerPage = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OperationOpt	= SPINAND_QUAD_READ | SPINAND_QUAD_PROGRAM |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			SPINAND_DUAL_READ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.MaxEraseTimes  = 50000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccType	= BIT3_LIMIT3_TO_4_ERR7,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccProtectedType = SIZE16_OFF0_LEN16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BadBlockFlag = BAD_BLK_FLAG_FRIST_1_PAGE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.Model		= &quot;FS35ND01G-S1Y2QWFI000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.NandID		= {0xcd, 0xea, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.DieCntPerChip  = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.SectCntPerPage = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.PageCntPerBlk  = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BlkCntPerDie	= 1024,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OobSizePerPage = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OperationOpt	= SPINAND_QUAD_READ | SPINAND_QUAD_PROGRAM |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			SPINAND_DUAL_READ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.MaxEraseTimes  = 50000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccType	= BIT2_LIMIT1_ERR2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccProtectedType = SIZE16_OFF0_LEN16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BadBlockFlag = BAD_BLK_FLAG_FRIST_1_PAGE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.Model		= &quot;FS35SQA001G&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.NandID		= {0xcd, 0x71, 0x71, 0xff, 0xff, 0xff, 0xff, 0xff},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.DieCntPerChip  = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.SectCntPerPage = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.PageCntPerBlk  = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BlkCntPerDie	= 1024,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OobSizePerPage = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OperationOpt	= SPINAND_QUAD_READ | SPINAND_QUAD_PROGRAM |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			SPINAND_DUAL_READ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.MaxEraseTimes  = 50000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccType	= BIT2_LIMIT1_ERR2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccProtectedType = SIZE16_OFF0_LEN16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BadBlockFlag = BAD_BLK_FLAG_FRIST_1_PAGE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct aw_spinand_phy_info zetta[] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.Model		= &quot;ZD35Q1GAIB&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.NandID		= {0xba, 0x71, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.DieCntPerChip  = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.SectCntPerPage = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.PageCntPerBlk  = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BlkCntPerDie	= 1024,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OobSizePerPage = 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.OperationOpt	= SPINAND_QUAD_READ | SPINAND_QUAD_PROGRAM |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			SPINAND_DUAL_READ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.MaxEraseTimes  = 50000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccType	= BIT2_LIMIT1_ERR2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.EccProtectedType = SIZE16_OFF4_LEN4_OFF8,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.BadBlockFlag = BAD_BLK_FLAG_FIRST_2_PAGE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static const char *aw_spinand_info_model(struct aw_spinand_chip *chip)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	struct aw_spinand_phy_info *pinfo = chip-&gt;info-&gt;phy_info;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return pinfo-&gt;Model;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static void aw_spinand_info_nandid(struct aw_spinand_chip *chip,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		unsigned char *id, int cnt)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	int i;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	struct aw_spinand_phy_info *pinfo = chip-&gt;info-&gt;phy_info;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	cnt = min(cnt, MAX_ID_LEN);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	for (i = 0; i &lt; cnt; i++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		id[i] = pinfo-&gt;NandID[i];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static unsigned int aw_spinand_info_sector_size(struct aw_spinand_chip *chip)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return 1 &lt;&lt; SECTOR_SHIFT;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static unsigned int aw_spinand_info_phy_page_size(struct aw_spinand_chip *chip)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	struct aw_spinand_phy_info *pinfo = chip-&gt;info-&gt;phy_info;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return pinfo-&gt;SectCntPerPage * aw_spinand_info_sector_size(chip);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static unsigned int aw_spinand_info_page_size(struct aw_spinand_chip *chip)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#if IS_ENABLED(CONFIG_AW_SPINAND_SIMULATE_MULTIPLANE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return aw_spinand_info_phy_page_size(chip) * 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return aw_spinand_info_phy_page_size(chip);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#endif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static unsigned int aw_spinand_info_phy_block_size(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		struct aw_spinand_chip *chip)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	struct aw_spinand_phy_info *pinfo = chip-&gt;info-&gt;phy_info;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return pinfo-&gt;PageCntPerBlk * aw_spinand_info_phy_page_size(chip);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static unsigned int aw_spinand_info_block_size(struct aw_spinand_chip *chip)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	struct aw_spinand_phy_info *pinfo = chip-&gt;info-&gt;phy_info;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return pinfo-&gt;PageCntPerBlk * aw_spinand_info_page_size(chip);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static unsigned int aw_spinand_info_phy_oob_size(struct aw_spinand_chip *chip)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	struct aw_spinand_phy_info *pinfo = chip-&gt;info-&gt;phy_info;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return pinfo-&gt;OobSizePerPage;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static unsigned int aw_spinand_info_oob_size(struct aw_spinand_chip *chip)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#if IS_ENABLED(CONFIG_AW_SPINAND_SIMULATE_MULTIPLANE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return aw_spinand_info_phy_oob_size(chip) * 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return aw_spinand_info_phy_oob_size(chip);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#endif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static unsigned int aw_spinand_info_die_cnt(struct aw_spinand_chip *chip)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	struct aw_spinand_phy_info *pinfo = chip-&gt;info-&gt;phy_info;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return pinfo-&gt;DieCntPerChip;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static unsigned int aw_spinand_info_total_size(struct aw_spinand_chip *chip)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	struct aw_spinand_phy_info *pinfo = chip-&gt;info-&gt;phy_info;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return pinfo-&gt;DieCntPerChip * pinfo-&gt;BlkCntPerDie *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		aw_spinand_info_phy_block_size(chip);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static int aw_spinand_info_operation_opt(struct aw_spinand_chip *chip)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	struct aw_spinand_phy_info *pinfo = chip-&gt;info-&gt;phy_info;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return pinfo-&gt;OperationOpt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static int aw_spinand_info_max_erase_times(struct aw_spinand_chip *chip)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	struct aw_spinand_phy_info *pinfo = chip-&gt;info-&gt;phy_info;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return pinfo-&gt;MaxEraseTimes;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct spinand_manufacture {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	unsigned char id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	const char *name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	struct aw_spinand_phy_info *info;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	unsigned int cnt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define SPINAND_FACTORY_INFO(_id, _name, _info)			\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{							\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.id = _id,					\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.name = _name,					\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.info = _info,					\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.cnt = ARRAY_SIZE(_info),			\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static struct spinand_manufacture spinand_factory[] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	SPINAND_FACTORY_INFO(MICRON_MANUFACTURE, &quot;Micron&quot;, micron),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	SPINAND_FACTORY_INFO(GD_MANUFACTURE, &quot;GD&quot;, gigadevice),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	SPINAND_FACTORY_INFO(ATO_MANUFACTURE, &quot;ATO&quot;, ato),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	SPINAND_FACTORY_INFO(WINBOND_MANUFACTURE, &quot;Winbond&quot;, winbond),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	SPINAND_FACTORY_INFO(MXIC_MANUFACTURE, &quot;Mxic&quot;, mxic),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	SPINAND_FACTORY_INFO(TOSHIBA_MANUFACTURE, &quot;Toshiba&quot;, toshiba),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	SPINAND_FACTORY_INFO(ETRON_MANUFACTURE, &quot;Etron&quot;, etron),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	SPINAND_FACTORY_INFO(XTXTECH_MANUFACTURE, &quot;XTX&quot;, xtx),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	SPINAND_FACTORY_INFO(DSTECH_MANUFACTURE, &quot;Dosilicon&quot;, dosilicon),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	SPINAND_FACTORY_INFO(FORESEE_MANUFACTURE, &quot;Foresee&quot;, foresee),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	SPINAND_FACTORY_INFO(ZETTA_MANUFACTURE, &quot;Zetta&quot;, zetta),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	SPINAND_FACTORY_INFO(FM_MANUFACTURE, &quot;FM&quot;, fm),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static int spinand_get_chip_munufacture(struct aw_spinand_chip *chip, const char **m)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	struct aw_spinand_phy_info *info = chip-&gt;info-&gt;phy_info;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	switch (info-&gt;NandID[0]) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	case MICRON_MANUFACTURE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		*m = &quot;Micron&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	case GD_MANUFACTURE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		*m = &quot;GD&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	case ATO_MANUFACTURE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		*m = &quot;ATO&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	case WINBOND_MANUFACTURE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		*m = &quot;Winbond&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	case MXIC_MANUFACTURE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		*m = &quot;Mxic&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	case TOSHIBA_MANUFACTURE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		*m = &quot;Toshiba&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	case ETRON_MANUFACTURE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		*m = &quot;Etron&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	case XTXTECH_MANUFACTURE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		*m = &quot;XTX&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	case DSTECH_MANUFACTURE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		*m = &quot;Dosilicon&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	case FORESEE_MANUFACTURE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		*m = &quot;Foresee&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	case ZETTA_MANUFACTURE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		*m = &quot;Zetta&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		*m = NULL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (*m == NULL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static const char *aw_spinand_info_manufacture(struct aw_spinand_chip *chip)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	int i, j;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	struct spinand_manufacture *m;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	struct aw_spinand_phy_info *pinfo;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	const char *m_name = NULL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	int ret = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	for (i = 0; i &lt; ARRAY_SIZE(spinand_factory); i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		m = &amp;spinand_factory[i];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pinfo = chip-&gt;info-&gt;phy_info;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		for (j = 0; j &lt; m-&gt;cnt; j++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			if (pinfo == &amp;m-&gt;info[j])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				return m-&gt;name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	/*for compatible fdt support spi-nand*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ret = spinand_get_chip_munufacture(chip, &amp;m_name);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (ret &lt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return NULL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return m_name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static struct spinand_manufacture *spinand_detect_munufacture(unsigned char id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	int index;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	struct spinand_manufacture *m;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	for (index = 0; index &lt; ARRAY_SIZE(spinand_factory); index++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		m = &amp;spinand_factory[index];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		if (m-&gt;id == id) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			pr_info(&quot;detect munufacture from id table: %s\n&quot;, m-&gt;name);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			return m;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_err(&quot;not detect any munufacture from id table\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return NULL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static struct aw_spinand_phy_info *spinand_match_id(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		struct spinand_manufacture *m,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		unsigned char *id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	int i, j, match_max = 1, match_index = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	struct aw_spinand_phy_info *pinfo;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	for (i = 0; i &lt; m-&gt;cnt; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		int match = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pinfo = &amp;m-&gt;info[i];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		for (j = 1; j &lt; MAX_ID_LEN; j++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			/* 0xFF matching all ID value */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			if (pinfo-&gt;NandID[j] != id[j] &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					pinfo-&gt;NandID[j] != 0xFF)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			if (pinfo-&gt;NandID[j] != 0xFF)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				match++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		if (match &gt; match_max) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			match_max = match;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			match_index = i;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (match_max &gt; 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return &amp;m-&gt;info[match_index];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return NULL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct aw_spinand_phy_info *spinand_get_phy_info_from_fdt(struct aw_spinand_chip *chip)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	static struct aw_spinand_phy_info info;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	static int had_get;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	int ret = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	const char *bad_blk_mark_pos = NULL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	const char *quad_read_not_need_enable = NULL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	const char *read_seq_need_onedummy = NULL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	int len = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	u32 id = 0xffffffff;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	struct device_node *node = chip-&gt;spi-&gt;dev.of_node;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	u32 rx_bus_width = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	u32 tx_bus_width = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (had_get == true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return &amp;info;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define BAD_BLK_MARK_POS1 &quot;first_1_page&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define BAD_BLK_MARK_POS2 &quot;first_2_page&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define BAD_BLK_MARK_POS3 &quot;last_1_page&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define BAD_BLK_MARK_POS4 &quot;last_2_page&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	memset(&amp;info, 0, sizeof(struct aw_spinand_phy_info));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ret = of_property_read_string(node, &quot;model&quot;, &amp;(info.Model));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (ret &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pr_err(&quot;get spi-nand Model from fdt fail\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		goto err;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ret = of_property_read_u32(node, &quot;id-0&quot;, &amp;id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (ret &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pr_err(&quot;get spi-nand id Low 4 Byte from fdt fail\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		goto err;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	len = sizeof(id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	memmove(info.NandID, &amp;id, min(MAX_ID_LEN, len));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	id = 0xffffffff;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ret = of_property_read_u32(node, &quot;id-1&quot;, &amp;id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (ret &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pr_info(&quot;can&#x27;t get spi-nand id high 4 Byte from fdt, may be not need\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	memmove(info.NandID + min(MAX_ID_LEN, len), &amp;id, max(MAX_ID_LEN, len) - min(MAX_ID_LEN, len));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ret = of_property_read_u32(node, &quot;die_cnt_per_chip&quot;, &amp;(info.DieCntPerChip));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (ret &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pr_err(&quot;get spi-nand DieCntPerChip from fdt fail\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		goto err;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ret = of_property_read_u32(node, &quot;blk_cnt_per_die&quot;, &amp;(info.BlkCntPerDie));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (ret &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pr_err(&quot;get spi-nand BlkCntPerDie from fdt fail\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		goto err;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ret = of_property_read_u32(node, &quot;page_cnt_per_blk&quot;, &amp;(info.PageCntPerBlk));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (ret &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pr_err(&quot;get spi-nand PageCntPerBlk from fdt fail\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		goto err;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ret = of_property_read_u32(node, &quot;sect_cnt_per_page&quot;, &amp;(info.SectCntPerPage));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (ret &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pr_err(&quot;get spi-nand SectCntPerPage from fdt fail\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		goto err;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ret = of_property_read_u32(node, &quot;oob_size_per_page&quot;, &amp;(info.OobSizePerPage));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (ret &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pr_err(&quot;get spi-nand OobSizePerPage from fdt fail\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		goto err;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ret = of_property_read_string(node, &quot;bad_block_mark_pos&quot;, &amp;bad_blk_mark_pos);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (ret &lt; 0 || NULL == bad_blk_mark_pos) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pr_err(&quot;get spi-nand BadBlockFlag from fdt fail\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		goto err;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		if (!memcmp(bad_blk_mark_pos, BAD_BLK_MARK_POS1, strlen(BAD_BLK_MARK_POS1)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			info.BadBlockFlag = BAD_BLK_FLAG_FRIST_1_PAGE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		else if (!memcmp(bad_blk_mark_pos, BAD_BLK_MARK_POS2, strlen(BAD_BLK_MARK_POS2)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			info.BadBlockFlag = BAD_BLK_FLAG_FRIST_1_PAGE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		else if (!memcmp(bad_blk_mark_pos, BAD_BLK_MARK_POS3, strlen(BAD_BLK_MARK_POS3)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			info.BadBlockFlag = BAD_BLK_FLAG_LAST_1_PAGE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		else if (!memcmp(bad_blk_mark_pos, BAD_BLK_MARK_POS4, strlen(BAD_BLK_MARK_POS4)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			info.BadBlockFlag = BAD_BLK_FLAG_LAST_2_PAGE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			pr_err(&quot;get spi-nand BadBlockFlag pattern is not right\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			goto err;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ret = of_property_read_s32(node, &quot;max_erase_times&quot;, &amp;(info.MaxEraseTimes));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (ret &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pr_err(&quot;get spi-nand MaxEraseTimes from fdt fail\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		goto err;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ret = of_property_read_u32(node, &quot;ecc_type&quot;, &amp;(info.EccType));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (ret &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pr_err(&quot;get spi-nand EccFlag from fdt fail\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		goto err;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ret = of_property_read_u32(node, &quot;ecc_protected_type&quot;, &amp;(info.EccProtectedType));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (ret &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pr_err(&quot;get spi-nand ecc_protected_type from fdt fail\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		goto err;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ret = of_property_read_u32(node, &quot;spi-rx-bus-width&quot;, &amp;rx_bus_width);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (ret &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pr_err(&quot;get spi-nand spi-rx-bus-width from fdt fail\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		goto err;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		switch (rx_bus_width) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		case SPI_NBITS_DUAL:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			info.OperationOpt |= SPINAND_DUAL_READ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		case SPI_NBITS_QUAD:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			info.OperationOpt |= SPINAND_QUAD_READ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			info.OperationOpt |= 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ret = of_property_read_u32(node, &quot;spi-tx-bus-width&quot;, &amp;tx_bus_width);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (ret &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pr_err(&quot;get spi-nand spi-tx-bus-width from fdt fail\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		goto err;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		switch (tx_bus_width) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		case SPI_NBITS_QUAD:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			info.OperationOpt |= SPINAND_QUAD_PROGRAM;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			info.OperationOpt |= 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ret = of_property_read_string(node, &quot;read_from_cache_x4_not_need_enable&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&amp;quad_read_not_need_enable);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;%d quad_read_not_need_enable:%s\n&quot;, __LINE__, quad_read_not_need_enable);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (ret &lt; 0 || NULL == quad_read_not_need_enable) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pr_info(&quot;can&#x27;t get spi-nand read_from_cache_x4_need_enable or it is null,&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				&quot; maybe not need enable quad read before read from cache x4\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		if (!memcmp(quad_read_not_need_enable, &quot;yes&quot;, strlen(&quot;yes&quot;)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			info.OperationOpt |= SPINAND_QUAD_NO_NEED_ENABLE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ret = of_property_read_string(node, &quot;read_from_cache_need_onedummy&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&amp;read_seq_need_onedummy);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (ret &lt; 0 || NULL == read_seq_need_onedummy) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pr_info(&quot;can&#x27;t get spi-nand read_from_cache_need_onedummy or it is null,&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				&quot; maybe read from cache sequence not need one dummy in second Byte\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		if (!memcmp(read_seq_need_onedummy, &quot;yes&quot;, strlen(&quot;yes&quot;)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			info.OperationOpt |= SPINAND_ONEDUMMY_AFTER_RANDOMREAD;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ret = of_property_read_s32(node, &quot;ecc_flag&quot;, &amp;(info.EccFlag));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (ret &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pr_err(&quot;can&#x27;t get spi-nand EccFlag from fdt,&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				&quot; maybe(default) use 0FH + C0H to get feature,wich obtain ecc status\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ret = of_property_read_u32(node, &quot;ecc_status_shift&quot;, &amp;(info.ecc_status_shift));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (ret &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pr_info(&quot;can&#x27;t get spi-nand ecc_status_shift from fdt,&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				&quot; use default ecc_status_shift_4 to get ecc status in C0H\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_debug(&quot;get spinand phy info from fdt\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_debug(&quot;Model:%s\n&quot;, info.Model);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_debug(&quot;ID:%02x %02x %02x %02x %02x %02x %02x %02x\n&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			info.NandID[0], info.NandID[1], info.NandID[2], info.NandID[3],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			info.NandID[4], info.NandID[5], info.NandID[6], info.NandID[7]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_debug(&quot;DieCntPerChip:%d\n&quot;, info.DieCntPerChip);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_debug(&quot;BlkCntPerDie:%d\n&quot;, info.BlkCntPerDie);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_debug(&quot;PageCntPerBlk:%d\n&quot;, info.PageCntPerBlk);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_debug(&quot;SectCntPerPage:%d\n&quot;, info.SectCntPerPage);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_debug(&quot;OobSizePerPage:%d\n&quot;, info.OobSizePerPage);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_debug(&quot;BadBlockFlag:%d\n&quot;, info.BadBlockFlag);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_debug(&quot;OperationOpt:0x%x\n&quot;, info.OperationOpt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_debug(&quot;MaxEraseTimes:%d\n&quot;, info.MaxEraseTimes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_debug(&quot;EccFlag:%x\n&quot;, info.EccFlag);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_debug(&quot;ecc_status_shift:%x\n&quot;, info.ecc_status_shift);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_debug(&quot;EccType:%x\n&quot;, info.EccType);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_debug(&quot;EccProtectedType:%x\n&quot;, info.EccProtectedType);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	had_get = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return &amp;info;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">err:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	had_get = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return NULL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static struct aw_spinand_info aw_spinand_info = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.model = aw_spinand_info_model,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.manufacture = aw_spinand_info_manufacture,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.nandid = aw_spinand_info_nandid,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.die_cnt = aw_spinand_info_die_cnt,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.oob_size = aw_spinand_info_oob_size,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.page_size = aw_spinand_info_page_size,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.block_size = aw_spinand_info_block_size,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.phy_oob_size = aw_spinand_info_phy_oob_size,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.phy_page_size = aw_spinand_info_phy_page_size,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.phy_block_size = aw_spinand_info_phy_block_size,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.sector_size = aw_spinand_info_sector_size,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.total_size = aw_spinand_info_total_size,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.operation_opt = aw_spinand_info_operation_opt,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.max_erase_times = aw_spinand_info_max_erase_times,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static struct spinand_manufacture *spinand_detect_munufacture_from_fdt(struct aw_spinand_chip *chip, unsigned char id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	struct aw_spinand_phy_info *info = NULL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	struct spinand_manufacture *pm = &amp;m;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	int ret = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	info = spinand_get_phy_info_from_fdt(chip);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (info == NULL) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pr_err(&quot;get phy info from fdt fail\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		goto err;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (id == info-&gt;NandID[0]) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pm-&gt;id = info-&gt;NandID[0];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pm-&gt;info = info;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		chip-&gt;info = &amp;aw_spinand_info;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		chip-&gt;info-&gt;phy_info = info;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		ret = spinand_get_chip_munufacture(chip, &amp;(pm-&gt;name));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		if (ret &lt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			goto err;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			pr_info(&quot;detect munufacture from fdt: %s \n&quot;, pm-&gt;name);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		goto err;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return pm;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">err:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;not detect munufacture from fdt\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return NULL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static struct aw_spinand_phy_info *spinand_match_id_from_fdt(struct aw_spinand_chip *chip,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		struct spinand_manufacture *m,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		unsigned char *id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	struct aw_spinand_phy_info *info = NULL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	int i = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	info = spinand_get_phy_info_from_fdt(chip);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (info == NULL) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pr_err(&quot;get phy info from fdt fail\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		goto err;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	for (i = 0; i &lt; MAX_ID_LEN; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		/*0xff match all id value*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		if (id[i] != info-&gt;NandID[i] &amp;&amp; info-&gt;NandID[i] != 0xff)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			goto err;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return info;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">err:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return NULL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static int aw_spinand_info_init(struct aw_spinand_chip *chip,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		struct aw_spinand_phy_info *pinfo)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	chip-&gt;info = &amp;aw_spinand_info;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	chip-&gt;info-&gt;phy_info = pinfo;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;========== arch info ==========\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;Model:               %s\n&quot;, pinfo-&gt;Model);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;Munufacture:         %s\n&quot;, aw_spinand_info_manufacture(chip));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;DieCntPerChip:       %u\n&quot;, pinfo-&gt;DieCntPerChip);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;BlkCntPerDie:        %u\n&quot;, pinfo-&gt;BlkCntPerDie);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;PageCntPerBlk:       %u\n&quot;, pinfo-&gt;PageCntPerBlk);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;SectCntPerPage:      %u\n&quot;, pinfo-&gt;SectCntPerPage);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;OobSizePerPage:      %u\n&quot;, pinfo-&gt;OobSizePerPage);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;BadBlockFlag:        0x%x\n&quot;, pinfo-&gt;BadBlockFlag);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;OperationOpt:        0x%x\n&quot;, pinfo-&gt;OperationOpt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;MaxEraseTimes:       %d\n&quot;, pinfo-&gt;MaxEraseTimes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;EccFlag:             0x%x\n&quot;, pinfo-&gt;EccFlag);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;EccType:             %d\n&quot;, pinfo-&gt;EccType);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;EccProtectedType:    %d\n&quot;, pinfo-&gt;EccProtectedType);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;========================================\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;========== physical info ==========\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;TotalSize:    %u M\n&quot;, to_mb(aw_spinand_info_total_size(chip)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;SectorSize:   %u B\n&quot;, aw_spinand_info_sector_size(chip));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;PageSize:     %u K\n&quot;, to_kb(aw_spinand_info_phy_page_size(chip)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;BlockSize:    %u K\n&quot;, to_kb(aw_spinand_info_phy_block_size(chip)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;OOBSize:      %u B\n&quot;, aw_spinand_info_phy_oob_size(chip));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;========================================\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;========== logical info ==========\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;TotalSize:    %u M\n&quot;, to_mb(aw_spinand_info_total_size(chip)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;SectorSize:   %u B\n&quot;, aw_spinand_info_sector_size(chip));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;PageSize:     %u K\n&quot;, to_kb(aw_spinand_info_page_size(chip)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;BlockSize:    %u K\n&quot;, to_kb(aw_spinand_info_block_size(chip)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;OOBSize:      %u B\n&quot;, aw_spinand_info_oob_size(chip));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;========================================\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int aw_spinand_chip_detect(struct aw_spinand_chip *chip)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	struct aw_spinand_phy_info *pinfo;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	struct spinand_manufacture *m;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	unsigned char id[MAX_ID_LEN] = {0xFF};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	struct aw_spinand_chip_ops *ops = chip-&gt;ops;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	int ret, dummy = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">retry:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	/*first read with dummy/address@0x00*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ret = ops-&gt;read_id(chip, id, MAX_ID_LEN, dummy);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (ret) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pr_err(&quot;read id failed : %d\n&quot;, ret);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	m = spinand_detect_munufacture(id[0]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (!m)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		goto detect_from_fdt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pinfo = spinand_match_id(m, id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (pinfo)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		goto detect;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">detect_from_fdt:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		m = spinand_detect_munufacture_from_fdt(chip, id[0]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		if (!m)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			goto not_detect;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pinfo = spinand_match_id_from_fdt(chip, m, id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		if (pinfo)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			goto detect;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">not_detect:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	/* retry without dummy/address@0x00 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (dummy) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		dummy = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		goto retry;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;not match spinand: %x %x\n&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			*(__u32 *)id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			*((__u32 *)id + 1));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return -ENODEV;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">detect:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	pr_info(&quot;detect spinand id: %x %x\n&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			*((__u32 *)pinfo-&gt;NandID),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			*((__u32 *)pinfo-&gt;NandID + 1));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return aw_spinand_info_init(chip, pinfo);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MODULE_AUTHOR(&quot;liaoweixiong &lt;liaoweixiong@allwinnertech.com&gt;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MODULE_DESCRIPTION(&quot;Commond physic layer for Allwinner&#x27;s spinand driver&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>重新编译打包</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">book@100ask:~/tina-v853$ make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">book@100ask:~/tina-v853$ pack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/100askTeam/AllwinnerVisionIC-Docs/tree/main/docs/V851S/part1/01-3_SomeQustion.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/V851S/part1/01-2_FlashSystem"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">更新系统固件</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/category/最小系统快速上手"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">最小系统快速上手</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1编译执行make时报文件系统权限不够的问题" class="table-of-contents__link toc-highlight">1.编译执行make时报文件系统权限不够的问题</a></li><li><a href="#2打包pack时提示文件系统大小太大" class="table-of-contents__link toc-highlight">2.打包pack时提示文件系统大小太大</a></li><li><a href="#3开发板启动时启动nand失败" class="table-of-contents__link toc-highlight">3.开发板启动时，启动nand失败</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 100askTeam, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>